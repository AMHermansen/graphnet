# lightning.pytorch==2.0.9
seed_everything: 2023

trainer:
  accelerator: gpu
  strategy: auto
  devices:
   - 0
  num_nodes: 1
  precision: 32-true
  logger: null
  callbacks:
    - class_path: graphnet.training.callbacks.GNProgressBar
    - class_path: graphnet.training.callbacks.WriteValToParquetWithPlot
      init_args:
        output_dir: "/lustre/hpc/icecube/andreash/workspace/conf_test_out"
        overwrite_results_folder: true  # default: false, might overwrite existing results if set to true. But can be useful when testing.
        additional_attributes:
          - event_no
          - dummy_pid
  fast_dev_run: false
  max_epochs: 20
  min_epochs: null
  max_steps: -1
  min_steps: null
  max_time: null
  limit_train_batches: null
  limit_val_batches: null
  limit_test_batches: null
  limit_predict_batches: null
  overfit_batches: 0.0
  val_check_interval: null
  check_val_every_n_epoch: 1
  num_sanity_val_steps: null
  log_every_n_steps: null
  enable_checkpointing: null
  enable_progress_bar: null
  enable_model_summary: null
  accumulate_grad_batches: 1
  gradient_clip_val: null
  gradient_clip_algorithm: null
  deterministic: null
  benchmark: null
  inference_mode: true
  use_distributed_sampler: true
  profiler: null
  detect_anomaly: false
  barebones: false
  plugins: null
  sync_batchnorm: false
  reload_dataloaders_every_n_epochs: 0
  default_root_dir: null

model:
  optimizer_class: lion_pytorch.Lion
  optimizer_kwargs: {lr: 5e-5}
  scheduler_class: torch.optim.lr_scheduler.OneCycleLR
  scheduler_kwargs:
    anneal_strategy: cos
    max_lr: 5e-4
    epochs: ${trainer.max_epochs}
    steps_per_epoch: 40
  scheduler_config:
    interval: step
    frequency: 1

data:
  db: /lustre/hpc/icecube/andreash/workspace/graphnet/data/examples/sqlite/prometheus/prometheus-events.db
  pulsemaps:
    - total
  features:
    - sensor_pos_x
    - sensor_pos_y
    - sensor_pos_z
    - t
  truth:
    - injection_energy
    - injection_type
    - injection_interaction_type
    - injection_zenith
    - injection_azimuth
    - injection_bjorkenx
    - injection_bjorkeny
    - injection_position_x
    - injection_position_y
    - injection_position_z
    - injection_column_depth
    - primary_lepton_1_type
    - primary_hadron_1_type
    - primary_lepton_1_position_x
    - primary_lepton_1_position_y
    - primary_lepton_1_position_z
    - primary_hadron_1_position_x
    - primary_hadron_1_position_y
    - primary_hadron_1_position_z
    - primary_lepton_1_direction_theta
    - primary_lepton_1_direction_phi
    - primary_hadron_1_direction_theta
    - primary_hadron_1_direction_phi
    - primary_lepton_1_energy
    - primary_hadron_1_energy
    - total_energy
    - dummy_pid
  batch_size: 128
  train_shuffle: true
  selection:
    train: /lustre/hpc/icecube/andreash/workspace/graphnet/configs/selections/train.csv
    val: /lustre/hpc/icecube/andreash/workspace/graphnet/configs/selections/val.csv
    test: /lustre/hpc/icecube/andreash/workspace/graphnet/configs/selections/test.csv
  num_workers: 10
  persistent_workers: true
  node_truth: null
  truth_table: mc_truth
  node_truth_table: null
  string_selection: null
  loss_weight_table: null
  loss_weight_column: null
  index_column: event_no
  labels: null

ckpt_path: null

gnn:
  class_path: graphnet.models.gnn.ODynEdge
  init_args:
    nb_neighbours: 8
    features_subset: null
    dynedge_layer_sizes: null
    post_processing_layer_sizes: null
    readout_layer_sizes: null
    global_pooling_schemes: [min, max, mean, sum]
    add_global_variables_after_pooling: false

graph_definition:
  class_path: graphnet.models.graphs.GraphDefinition
  init_args:
    detector:
      class_path: graphnet.models.detector.Prometheus
    node_definition:
      class_path: graphnet.models.graphs.NodesAsPulses
    edge_definition:
      class_path: graphnet.models.graphs.KNNEdges
      init_args:
        nb_nearest_neighbours: 8
        columns:
          - 0
          - 1
          - 2

tasks:
  class_path: graphnet.models.task.MulticlassClassificationTask
  init_args:
    nb_outputs: 3
    target_labels: dummy_pid
    prediction_labels:
      - noise
      - muon
      - neutrino
    loss_function:
      class_path: graphnet.training.loss_functions.CrossEntropyLoss
      init_args:
        options: {1: 0, -1: 0, 13: 1, -13: 1, 12: 2, -12: 2, 14: 2, -14: 2, 16: 2, -16: 2}
    transform_prediction_and_target: null
    transform_target: null
    transform_inference: null
    transform_support: null
    loss_weight: null
    roc_curve_data:
      class_path: graphnet.plot.utils.ROCCurveData
      init_args:
        legend_labels:
          - noise
          - muon
          - nu
